Object.defineProperty(exports, "__esModule", {
  value: true
});

var _git_log_format_markers = require('./constants/git_log_format_markers');

var _parse_commit = require('./parse_commit');

var _parse_commit2 = _interopRequireDefault(_parse_commit);

var _byline = require('byline');

var _byline2 = _interopRequireDefault(_byline);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var parseGitLog = function parseGitLog(stream) {
  return new Promise(function (resolve, reject) {
    var buffer = [];
    var parsedCommits = [];
    var streamByLine = (0, _byline2.default)(stream);
    var commitPattern = _git_log_format_markers.gitLogCommitMarker;

    streamByLine.on('data', function (line) {
      var lineString = line.toString();
      if (lineString.match(commitPattern)) {
        if (buffer.length) {
          parsedCommits.push((0, _parse_commit2.default)(buffer));
          buffer = [];
        }
      } else {
        buffer.push(lineString);
      }
    });

    streamByLine.on('error', function (e) {
      reject(e);
    });

    streamByLine.on('end', function () {
      if (buffer.length) {
        parsedCommits.push((0, _parse_commit2.default)(buffer));
      }
      resolve(parsedCommits);
    });
  });
};

exports.default = parseGitLog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJzZV9naXRfbG9nLmpzIl0sIm5hbWVzIjpbInBhcnNlR2l0TG9nIiwic3RyZWFtIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJidWZmZXIiLCJwYXJzZWRDb21taXRzIiwic3RyZWFtQnlMaW5lIiwiY29tbWl0UGF0dGVybiIsIm9uIiwibGluZVN0cmluZyIsImxpbmUiLCJ0b1N0cmluZyIsIm1hdGNoIiwibGVuZ3RoIiwicHVzaCIsImUiXSwibWFwcGluZ3MiOiI7Ozs7QUFFQTs7QUFDQTs7OztBQUNBOzs7Ozs7QUFFQSxJQUFNQSxjQUFjLFNBQWRBLFdBQWMsQ0FBQ0MsTUFBRCxFQUF1QztBQUN6RCxTQUFPLElBQUlDLE9BQUosQ0FBWSxVQUFDQyxPQUFELEVBQVVDLE1BQVYsRUFBcUI7QUFDdEMsUUFBSUMsU0FBUyxFQUFiO0FBQ0EsUUFBTUMsZ0JBQWdCLEVBQXRCO0FBQ0EsUUFBTUMsZUFBZSxzQkFBT04sTUFBUCxDQUFyQjtBQUNBLFFBQU1PLDBEQUFOOztBQUVBRCxpQkFBYUUsRUFBYixDQUFnQixNQUFoQixFQUF3QixnQkFBUTtBQUM5QixVQUFNQyxhQUFhQyxLQUFLQyxRQUFMLEVBQW5CO0FBQ0EsVUFBSUYsV0FBV0csS0FBWCxDQUFpQkwsYUFBakIsQ0FBSixFQUFxQztBQUNuQyxZQUFJSCxPQUFPUyxNQUFYLEVBQW1CO0FBQ2pCUix3QkFBY1MsSUFBZCxDQUFtQiw0QkFBWVYsTUFBWixDQUFuQjtBQUNBQSxtQkFBUyxFQUFUO0FBQ0Q7QUFDRixPQUxELE1BS087QUFDTEEsZUFBT1UsSUFBUCxDQUFZTCxVQUFaO0FBQ0Q7QUFDRixLQVZEOztBQVlBSCxpQkFBYUUsRUFBYixDQUFnQixPQUFoQixFQUF5QixhQUFLO0FBQzVCTCxhQUFPWSxDQUFQO0FBQ0QsS0FGRDs7QUFJQVQsaUJBQWFFLEVBQWIsQ0FBZ0IsS0FBaEIsRUFBdUIsWUFBTTtBQUMzQixVQUFJSixPQUFPUyxNQUFYLEVBQW1CO0FBQ2pCUixzQkFBY1MsSUFBZCxDQUFtQiw0QkFBWVYsTUFBWixDQUFuQjtBQUNEO0FBQ0RGLGNBQVFHLGFBQVI7QUFDRCxLQUxEO0FBTUQsR0E1Qk0sQ0FBUDtBQTZCRCxDQTlCRDs7a0JBZ0NlTixXIiwiZmlsZSI6InBhcnNlX2dpdF9sb2cuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuaW1wb3J0IHR5cGUge0dpdENvbW1pdH0gZnJvbSAnLi90eXBlcy9naXRfY29tbWl0X3R5cGUnO1xuaW1wb3J0IHtnaXRMb2dDb21taXRNYXJrZXJ9IGZyb20gJy4vY29uc3RhbnRzL2dpdF9sb2dfZm9ybWF0X21hcmtlcnMnO1xuaW1wb3J0IHBhcnNlQ29tbWl0IGZyb20gJy4vcGFyc2VfY29tbWl0JztcbmltcG9ydCBieWxpbmUgZnJvbSAnYnlsaW5lJztcblxuY29uc3QgcGFyc2VHaXRMb2cgPSAoc3RyZWFtOiBhbnkpOiBQcm9taXNlPEdpdENvbW1pdFtdPiA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgbGV0IGJ1ZmZlciA9IFtdO1xuICAgIGNvbnN0IHBhcnNlZENvbW1pdHMgPSBbXTtcbiAgICBjb25zdCBzdHJlYW1CeUxpbmUgPSBieWxpbmUoc3RyZWFtKTtcbiAgICBjb25zdCBjb21taXRQYXR0ZXJuID0gZ2l0TG9nQ29tbWl0TWFya2VyO1xuXG4gICAgc3RyZWFtQnlMaW5lLm9uKCdkYXRhJywgbGluZSA9PiB7XG4gICAgICBjb25zdCBsaW5lU3RyaW5nID0gbGluZS50b1N0cmluZygpO1xuICAgICAgaWYgKGxpbmVTdHJpbmcubWF0Y2goY29tbWl0UGF0dGVybikpIHtcbiAgICAgICAgaWYgKGJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgICBwYXJzZWRDb21taXRzLnB1c2gocGFyc2VDb21taXQoYnVmZmVyKSk7XG4gICAgICAgICAgYnVmZmVyID0gW107XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1ZmZlci5wdXNoKGxpbmVTdHJpbmcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc3RyZWFtQnlMaW5lLm9uKCdlcnJvcicsIGUgPT4ge1xuICAgICAgcmVqZWN0KGUpO1xuICAgIH0pO1xuXG4gICAgc3RyZWFtQnlMaW5lLm9uKCdlbmQnLCAoKSA9PiB7XG4gICAgICBpZiAoYnVmZmVyLmxlbmd0aCkge1xuICAgICAgICBwYXJzZWRDb21taXRzLnB1c2gocGFyc2VDb21taXQoYnVmZmVyKSk7XG4gICAgICB9XG4gICAgICByZXNvbHZlKHBhcnNlZENvbW1pdHMpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHBhcnNlR2l0TG9nO1xuIl19