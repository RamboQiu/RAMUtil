{"version":3,"file":"bundle.umd.js","sources":["../src/index.ts"],"sourcesContent":["import {\n  ApolloLink,\n  Observable,\n  Operation,\n  NextLink,\n  GraphQLRequest,\n} from 'apollo-link';\n\nexport type ContextSetter = (\n  operation: GraphQLRequest,\n  prevContext: any,\n) => Promise<any> | any;\n\nexport const setContext = (setter: ContextSetter): ApolloLink =>\n  new ApolloLink((operation: Operation, forward: NextLink) => {\n    const { ...request } = operation;\n\n    return new Observable(observer => {\n      let handle;\n      Promise.resolve(request)\n        .then(req => setter(req, operation.getContext()))\n        .then(operation.setContext)\n        .then(() => {\n          handle = forward(operation).subscribe({\n            next: observer.next.bind(observer),\n            error: observer.error.bind(observer),\n            complete: observer.complete.bind(observer),\n          });\n        })\n        .catch(observer.error.bind(observer));\n\n      return () => {\n        if (handle) handle.unsubscribe();\n      };\n    });\n  });\n"],"names":["ApolloLink","Observable"],"mappings":";;;;;;;;;;;;;;;AAAA,QAaa,UAAU,GAAG,UAAC,MAAqB;QAC9C,OAAA,IAAIA,qBAAU,CAAC,UAAC,SAAoB,EAAE,OAAiB;YACrD,IAAQ,+BAAwB,CAAC;YAEjC,OAAO,IAAIC,qBAAU,CAAC,UAAA,QAAQ;gBAC5B,IAAI,MAAM,CAAC;gBACX,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;qBACrB,IAAI,CAAC,UAAA,GAAG,IAAI,OAAA,MAAM,CAAC,GAAG,EAAE,SAAS,CAAC,UAAU,EAAE,CAAC,GAAA,CAAC;qBAChD,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC;qBAC1B,IAAI,CAAC;oBACJ,MAAM,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC;wBACpC,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;wBAClC,KAAK,EAAE,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC;wBACpC,QAAQ,EAAE,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC;qBAC3C,CAAC,CAAC;iBACJ,CAAC;qBACD,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAExC,OAAO;oBACL,IAAI,MAAM;wBAAE,MAAM,CAAC,WAAW,EAAE,CAAC;iBAClC,CAAC;aACH,CAAC,CAAC;SACJ,CAAC;IArBF,CAqBE;;;;;;;;;;;;"}